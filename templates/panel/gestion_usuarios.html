{% extends "panel/base.html" %}
{% block extraCss %}
<style>
    /* Prevenir overflow horizontal en la página */
    html, body {
        overflow-x: hidden;
        max-width: 100%;
    }

    .card-body {
        overflow-x: hidden;
    }

    .container-fluid {
        overflow-x: hidden;
        max-width: 100%;
    }

    /* ============================================= */
    /* Estilos profesionales para DataTable         */
    /* ============================================= */
    #data_table_ajax {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        font-size: 13px;
    }

    #data_table_ajax thead th {
        background: linear-gradient(135deg, #13304D 0%, #1a4066 100%);
        color: #fff;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 14px 12px;
        border: none;
        position: relative;
    }

    #data_table_ajax thead th:first-child {
        border-radius: 8px 0 0 0;
    }

    #data_table_ajax thead th:last-child {
        border-radius: 0 8px 0 0;
    }

    #data_table_ajax tbody tr {
        transition: all 0.2s ease;
        border-bottom: 1px solid #eef2f7;
    }

    #data_table_ajax tbody tr:hover {
        background-color: #f8fafc;
        transform: scale(1.002);
        box-shadow: 0 2px 8px rgba(19, 48, 77, 0.08);
    }

    #data_table_ajax tbody td {
        padding: 12px;
        vertical-align: middle;
        border-bottom: 1px solid #eef2f7;
        color: #374151;
    }

    #data_table_ajax tbody tr:last-child td {
        border-bottom: none;
    }

    /* Alternar colores de filas sutilmente */
    #data_table_ajax tbody tr:nth-child(even) {
        background-color: #fafbfc;
    }

    #data_table_ajax tbody tr:nth-child(odd) {
        background-color: #ffffff;
    }

    /* Estados especiales de filas - Usuario inactivo */
    #data_table_ajax tbody tr.usuario-inactivo {
        background-color: #f3f4f6 !important;
        opacity: 0.7;
    }

    #data_table_ajax tbody tr.usuario-inactivo:hover {
        background-color: #e5e7eb !important;
        opacity: 0.85;
    }

    /* Estilos para columna Estado - Badges modernos */
    .badge-estado {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 6px 12px;
        font-size: 11px;
        font-weight: 600;
        border-radius: 20px;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .badge-activo {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
    }

    .badge-inactivo {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
    }

    .badge-grupo {
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        color: #1e40af;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
    }

    .badge-origen {
        background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
        color: #6b21a8;
        box-shadow: 0 2px 4px rgba(147, 51, 234, 0.2);
        font-size: 10px;
        padding: 4px 8px;
    }

    /* Estilo para username */
    #data_table_ajax .usuario-username {
        font-weight: 700;
        color: var(--theme-primary);
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        font-size: 12px;
        background: #eef2f7;
        padding: 4px 8px;
        border-radius: 4px;
        letter-spacing: 0.3px;
    }

    /* Mejora visual para textos secundarios */
    #data_table_ajax .text-muted {
        color: #9ca3af !important;
        font-size: 11px;
    }

    /* DataTables wrapper styling */
    .dataTables_wrapper {
        padding-top: 10px;
    }

    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 13px;
        transition: all 0.2s ease;
    }

    .dataTables_wrapper .dataTables_filter input:focus {
        border-color: var(--theme-primary);
        box-shadow: 0 0 0 3px rgba(19, 48, 77, 0.1);
        outline: none;
    }

    .dataTables_wrapper .dataTables_info {
        color: #6b7280;
        font-size: 13px;
        padding-top: 15px;
    }

    .dataTables_wrapper .dataTables_paginate {
        padding-top: 15px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        border-radius: 6px !important;
        margin: 0 2px;
        padding: 6px 12px !important;
        border: 1px solid #e5e7eb !important;
        background: #fff !important;
        color: #374151 !important;
        transition: all 0.2s ease;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background: #f3f4f6 !important;
        border-color: #d1d5db !important;
        color: var(--theme-primary) !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
        background: var(--theme-primary) !important;
        border-color: var(--theme-primary) !important;
        color: #fff !important;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Card contenedora mejorada */
    .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .card .card-body {
        padding: 24px;
    }

    /* Contenedor de tabla con borde sutil */
    .table-responsive {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #eef2f7;
    }

    /* Botón Nuevo Usuario mejorado */
    .dt-btn-orange {
        background: linear-gradient(135deg, var(--theme-primary) 0%, #1a4066 100%) !important;
        border: none !important;
        border-radius: 8px !important;
        padding: 10px 18px !important;
        font-weight: 500 !important;
        font-size: 13px !important;
        transition: all 0.25s ease !important;
        box-shadow: 0 2px 6px rgba(19, 48, 77, 0.2) !important;
    }

    .dt-btn-orange:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 4px 12px rgba(19, 48, 77, 0.35) !important;
    }

    /* Estilos para la sección de filtros colapsable */
    .filtros-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
    }

    .btn-toggle-filtros {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background-color: var(--theme-primary);
        border: 1px solid var(--theme-primary);
        color: white;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-toggle-filtros:hover {
        background-color: var(--theme-primary-dark);
        border-color: var(--theme-primary-dark);
    }

    .btn-toggle-filtros i {
        transition: transform 0.3s ease;
    }

    .btn-toggle-filtros.collapsed i.fa-chevron-down {
        transform: rotate(0deg);
    }

    .btn-toggle-filtros:not(.collapsed) i.fa-chevron-down {
        transform: rotate(180deg);
    }

    .filtros-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 20px;
        height: 20px;
        padding: 0 6px;
        background-color: #e6603a;
        color: white;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 4px;
    }

    .filtros-badge.hidden {
        display: none;
    }

    .filtros-container {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .filtros-container.collapsed {
        display: none;
    }

    .filtros-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        width: 100%;
        box-sizing: border-box;
    }

    .filtro-item {
        box-sizing: border-box;
    }

    .filtro-item label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: #495057;
        margin-bottom: 5px;
    }

    .filtro-item .form-control,
    .filtro-item .select2-container {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box;
    }

    .filtro-item .form-control {
        font-size: 14px;
        height: 38px;
        border-radius: 4px;
    }

    .filtros-acciones {
        display: flex;
        gap: 8px;
        align-items: flex-end;
        padding-bottom: 2px;
        flex-shrink: 0;
    }

    .btn-filtrar {
        background-color: var(--theme-primary);
        border-color: var(--theme-primary);
        color: white;
        width: 38px;
        height: 38px;
        padding: 0;
        font-size: 15px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-filtrar:hover {
        background-color: var(--theme-primary-dark);
        border-color: var(--theme-primary-dark);
        color: white;
    }

    .btn-limpiar {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
        width: 38px;
        height: 38px;
        padding: 0;
        font-size: 15px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-limpiar:hover {
        background-color: #5a6268;
        border-color: #5a6268;
        color: white;
    }

    /* Botones de acción en tabla - Diseño profesional */
    .acciones-container {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
        min-width: 200px;
    }

    .btn-accion {
        width: 36px;
        height: 36px;
        padding: 0;
        margin: 0;
        font-size: 14px;
        border-radius: 8px;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid;
        position: relative;
        overflow: hidden;
    }

    .btn-accion i {
        font-size: 15px;
        position: relative;
        z-index: 1;
    }

    /* Paleta minimalista - colores por defecto, neutro en hover */
    .btn-accion.btn-ver-usuario {
        background: #f1f5f9;
        border-color: #94a3b8;
        color: #334155;
    }

    .btn-accion.btn-editar-usuario {
        background: #fffbeb;
        border-color: #fcd34d;
        color: #b45309;
    }

    .btn-accion.btn-imprimir-usuario {
        background: #f1f5f9;
        border-color: #94a3b8;
        color: #475569;
    }

    .btn-accion.btn-reset-password {
        background: #eef2ff;
        border-color: #a5b4fc;
        color: #4f46e5;
    }

    .btn-accion.btn-eliminar-usuario {
        background: #fef2f2;
        border-color: #fca5a5;
        color: #dc2626;
    }

    .btn-accion.btn-activar-usuario {
        background: #ecfdf5;
        border-color: #6ee7b7;
        color: #059669;
    }

    /* Hover - vuelven a neutro */
    .btn-accion.btn-ver-usuario:hover,
    .btn-accion.btn-editar-usuario:hover,
    .btn-accion.btn-imprimir-usuario:hover,
    .btn-accion.btn-reset-password:hover,
    .btn-accion.btn-eliminar-usuario:hover,
    .btn-accion.btn-activar-usuario:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
        color: #64748b;
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(100, 116, 139, 0.12);
    }

    .btn-accion:disabled {
        opacity: 0.5 !important;
        cursor: not-allowed !important;
        transform: none !important;
        box-shadow: none !important;
        background: #f1f5f9 !important;
        border-color: #e2e8f0 !important;
        color: #cbd5e1 !important;
    }

    /* Tooltip visual en hover */
    .btn-accion::before {
        content: attr(title);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(5px);
        padding: 4px 8px;
        background: #1f2937;
        color: white;
        font-size: 10px;
        border-radius: 4px;
        white-space: nowrap;
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 100;
    }

    .btn-accion:hover::before {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(-4px);
    }

    /* ============================================= */
    /* Vista Desktop (tabla)                         */
    /* ============================================= */
    .vista-desktop {
        display: block;
    }

    /* ============================================= */
    /* Vista Móvil (cards)                           */
    /* ============================================= */
    .vista-mobile {
        display: none;
    }

    /* Header móvil */
    .mobile-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .mobile-header .btn-nuevo {
        background-color: var(--theme-primary);
        border-color: var(--theme-primary);
        color: white;
        padding: 10px 18px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .mobile-header .btn-nuevo:hover {
        background-color: var(--theme-primary-dark);
        border-color: var(--theme-primary-dark);
    }

    .mobile-header .usuarios-count {
        font-size: 13px;
        color: #6c757d;
        font-weight: 500;
    }

    /* Cards container */
    .usuarios-cards-container {
        display: flex;
        flex-direction: column;
        gap: 14px;
    }

    /* Card individual de usuario - Diseño profesional */
    .usuario-card {
        background: #fff;
        border: none;
        border-radius: 12px;
        padding: 0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.04);
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: visible;
        position: relative;
    }

    .usuario-card::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(180deg, var(--theme-primary) 0%, #1a4066 100%);
        border-radius: 12px 0 0 12px;
    }

    .usuario-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 8px 24px rgba(0, 0, 0, 0.06);
    }

    /* Usuario inactivo */
    .usuario-card.card-inactivo::before {
        background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
    }

    .usuario-card.card-inactivo {
        opacity: 0.75;
    }

    /* Header de la card */
    .usuario-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 16px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-bottom: 1px solid #eef2f7;
        border-radius: 12px 12px 0 0;
    }

    .usuario-card-username {
        font-size: 13px;
        font-weight: 700;
        color: var(--theme-primary);
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        background: #eef2f7;
        padding: 4px 10px;
        border-radius: 6px;
        letter-spacing: 0.3px;
    }

    .usuario-card-estado {
        flex-shrink: 0;
    }

    /* Body de la card */
    .usuario-card-body {
        padding: 16px;
    }

    .usuario-card-nombre {
        font-size: 15px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 3px;
    }

    .usuario-card-email {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Info grid de la card */
    .usuario-card-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px 16px;
    }

    .usuario-card-info-item {
        display: flex;
        flex-direction: column;
    }

    .usuario-card-info-item .label {
        font-size: 10px;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
        font-weight: 600;
    }

    .usuario-card-info-item .value {
        font-size: 13px;
        color: #374151;
        font-weight: 500;
    }

    /* Footer de la card con acciones */
    .usuario-card-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 14px 16px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-top: 1px solid #eef2f7;
        overflow: visible;
        position: relative;
        border-radius: 0 0 12px 12px;
    }

    .usuario-card-footer .btn {
        padding: 10px 16px;
        font-size: 13px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
        transition: all 0.25s ease;
        border: none;
    }

    .usuario-card-footer .btn-ver {
        background: var(--theme-primary);
        color: white;
        box-shadow: 0 1px 3px rgba(19, 48, 77, 0.15);
    }

    .usuario-card-footer .btn-ver:hover {
        background: #0d2236;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(19, 48, 77, 0.25);
    }

    .usuario-card-footer .btn-acciones {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        color: #64748b;
    }

    .usuario-card-footer .btn-acciones:hover {
        background: #f1f5f9;
        border-color: #94a3b8;
        color: #475569;
    }

    /* Loading y empty state para cards */
    .usuarios-cards-loading {
        text-align: center;
        padding: 50px 20px;
        color: #9ca3af;
    }

    .usuarios-cards-loading i {
        font-size: 36px;
        margin-bottom: 12px;
        color: var(--theme-primary);
        opacity: 0.8;
    }

    .usuarios-cards-loading p {
        font-size: 14px;
        margin: 0;
    }

    .usuarios-cards-empty {
        text-align: center;
        padding: 50px 20px;
        color: #9ca3af;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        border-radius: 12px;
        border: 1px dashed #e5e7eb;
    }

    .usuarios-cards-empty i {
        font-size: 52px;
        margin-bottom: 16px;
        color: #d1d5db;
    }

    .usuarios-cards-empty p {
        font-size: 14px;
        margin: 0;
    }

    /* Paginación móvil */
    .mobile-pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin-top: 24px;
        flex-wrap: wrap;
    }

    .mobile-pagination .btn-page {
        width: 38px;
        height: 38px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: #fff;
        border: 1px solid #e5e7eb;
        color: #4b5563;
        font-size: 14px;
        transition: all 0.2s ease;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
    }

    .mobile-pagination .btn-page:hover:not(:disabled) {
        background: #f9fafb;
        border-color: #d1d5db;
        color: var(--theme-primary);
    }

    .mobile-pagination .btn-page.active {
        background: linear-gradient(135deg, var(--theme-primary) 0%, #1a4066 100%);
        border-color: var(--theme-primary);
        color: white;
        box-shadow: 0 2px 6px rgba(19, 48, 77, 0.25);
    }

    .mobile-pagination .btn-page:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .mobile-pagination .page-info {
        font-size: 13px;
        color: #6b7280;
        font-weight: 500;
        padding: 0 8px;
    }

    /* Dropdown de acciones en cards */
    .dropdown-acciones .dropdown-toggle::after {
        display: none;
    }

    .dropdown-acciones .dropdown-menu {
        min-width: 180px;
        padding: 8px;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12), 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid #eef2f7;
        z-index: 9999;
        position: absolute;
    }

    .dropdown-acciones.show .dropdown-menu {
        display: block;
    }

    .usuario-card {
        position: relative;
    }

    .usuario-card .dropdown.show {
        z-index: 9999;
    }

    .dropdown-acciones .dropdown-item {
        padding: 10px 14px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-radius: 8px;
        transition: all 0.15s ease;
    }

    .dropdown-acciones .dropdown-item i {
        width: 18px;
        text-align: center;
        font-size: 14px;
    }

    .dropdown-acciones .dropdown-item:hover {
        background-color: #f3f4f6;
    }

    .dropdown-acciones .dropdown-item:active {
        background-color: #e5e7eb;
    }

    .dropdown-acciones .dropdown-divider {
        margin: 6px 8px;
        border-color: #eef2f7;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .filtros-row {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 992px) {
        .filtros-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .vista-desktop {
            display: none !important;
        }

        .vista-mobile {
            display: block !important;
        }

        /* Ocultar botones de DataTables en móvil */
        .dt-buttons {
            display: none !important;
        }
    }

    @media (max-width: 576px) {
        .filtros-row {
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .filtros-container {
            padding: 12px;
        }

        .btn-toggle-filtros {
            width: 100%;
            justify-content: center;
        }

        .usuario-card-info {
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .usuario-card-footer {
            flex-direction: column;
        }

        .usuario-card-footer .btn {
            width: 100%;
            justify-content: center;
        }
    }

    /* Botón flotante volver arriba */
    .btn-volver-arriba {
        position: fixed;
        right: 20px;
        bottom: 90px;
        width: 45px;
        height: 45px;
        background-color: var(--theme-primary);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 999;
    }

    .btn-volver-arriba.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .btn-volver-arriba:hover {
        background-color: var(--theme-primary-dark);
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    @media (max-width: 768px) {
        .btn-volver-arriba {
            right: 15px;
            bottom: 85px;
            width: 42px;
            height: 42px;
            font-size: 16px;
        }
    }

    /* Avatar de usuario */
    .usuario-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--theme-primary) 0%, #1a4066 100%);
        color: white;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        margin-right: 10px;
    }

    .usuario-info-cell {
        display: flex;
        align-items: center;
    }
</style>
{% endblock %}

{% block main %}
{% load static %}

<div id="main-content" class="profilepage_2 blog-page">
    <div class="container-fluid">
        <div class="block-header">
            <div class="row g-3">
                <div class="col-lg-5 col-md-8 col-sm-12">
                    <h2><a href="javascript:void(0);" class="btn btn-xs btn-link btn-toggle-fullwidth"><i class="fa fa-arrow-right"></i></a>
                        {{ titulo }}</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'panel_home' %}"><i class="icon-home text-orange"></i></a></li>
                        <li class="breadcrumb-item active">{{ titulo }}</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-lg-12 col-md-12">
                <div class="card">
                    <div class="card-body">
                        <!-- Botón para mostrar/ocultar filtros -->
                        <div class="filtros-header">
                            <button type="button" class="btn-toggle-filtros collapsed" id="btn-toggle-filtros">
                                <i class="fa fa-filter"></i>
                                <span>Filtros</span>
                                <span class="filtros-badge hidden" id="filtros-badge">0</span>
                                <i class="fa fa-chevron-down"></i>
                            </button>
                        </div>

                        <!-- Filtros Avanzados (colapsable) -->
                        <div class="filtros-container collapsed" id="filtros-container">
                            <div class="filtros-row">
                                <!-- 1. Username -->
                                <div class="filtro-item">
                                    <label for="filtro-username">Username</label>
                                    <input type="text" class="form-control" id="filtro-username" placeholder="Usuario...">
                                </div>

                                <!-- 2. Nombre -->
                                <div class="filtro-item">
                                    <label for="filtro-nombre">Nombre</label>
                                    <input type="text" class="form-control" id="filtro-nombre" placeholder="Nombre o apellido...">
                                </div>

                                <!-- 3. Email -->
                                <div class="filtro-item">
                                    <label for="filtro-email">Email</label>
                                    <input type="text" class="form-control" id="filtro-email" placeholder="correo@...">
                                </div>

                                <!-- 4. Grupo -->
                                <div class="filtro-item">
                                    <label for="filtro-grupo">Grupo</label>
                                    <select class="form-control" id="filtro-grupo">
                                        <option value="">Todos</option>
                                        {% for grupo in grupos %}
                                        <option value="{{ grupo.id }}">{{ grupo.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <!-- 5. Sector -->
                                <div class="filtro-item">
                                    <label for="filtro-sector">Sector</label>
                                    <select class="form-control" id="filtro-sector">
                                        <option value="">Todos</option>
                                        {% for sector in sectores %}
                                        <option value="{{ sector.id }}">{{ sector.nombre }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <!-- 6. Rol/Cargo -->
                                <div class="filtro-item">
                                    <label for="filtro-origen">Rol</label>
                                    <select class="form-control" id="filtro-origen">
                                        <option value="">Todos</option>
                                        {% for code, label in origenes %}
                                        <option value="{{ code }}">{{ label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <!-- 7. Estado -->
                                <div class="filtro-item">
                                    <label for="filtro-estado">Estado</label>
                                    <select class="form-control" id="filtro-estado">
                                        <option value="">Todos</option>
                                        <option value="1">Activo</option>
                                        <option value="0">Inactivo</option>
                                    </select>
                                </div>

                                <!-- 8. Acciones de filtro -->
                                <div class="filtros-acciones">
                                    <button type="button" class="btn btn-filtrar" id="btn-aplicar-filtros" title="Aplicar filtros">
                                        <i class="fa fa-search"></i>
                                    </button>
                                    <button type="button" class="btn btn-limpiar" id="btn-limpiar-filtros" title="Limpiar filtros">
                                        <i class="fa fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Vista Desktop (Tabla) -->
                        <div class="vista-desktop">
                            <div class="row clearfix">
                                <div class="col-lg-12 col-md-12">
                                    <table id="data_table_ajax" class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Usuario</th>
                                                <th>Nombre</th>
                                                <th>Email</th>
                                                <th>Grupo</th>
                                                <th>Sector</th>
                                                <th>Origen</th>
                                                <th>Estado</th>
                                                <th>Última Conexión</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Vista Móvil (Cards) -->
                        <div class="vista-mobile">
                            <div class="mobile-header">
                                <button type="button" class="btn btn-nuevo" onclick="gestionUsuario('')">
                                    <i class="fa fa-plus"></i> Nuevo Usuario
                                </button>
                                <span class="usuarios-count" id="usuarios-count"></span>
                            </div>

                            <div id="usuarios-cards-container" class="usuarios-cards-container">
                                <div class="usuarios-cards-loading">
                                    <i class="fa fa-spinner fa-spin"></i>
                                    <p>Cargando usuarios...</p>
                                </div>
                            </div>

                            <div class="mobile-pagination" id="mobile-pagination" style="display: none;">
                                <button type="button" class="btn btn-page" id="btn-prev-page" disabled>
                                    <i class="fa fa-chevron-left"></i>
                                </button>
                                <span class="page-info" id="page-info">1 de 1</span>
                                <button type="button" class="btn btn-page" id="btn-next-page" disabled>
                                    <i class="fa fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Botón flotante volver arriba -->
<button type="button" class="btn-volver-arriba" id="btn-volver-arriba" title="Volver arriba">
    <i class="fa fa-chevron-up"></i>
</button>

{% endblock %}

{% block extraJS %}
<script>
$(document).ready(function(){
    // Cargar tabla al inicio
    cargarTabla();

    // Toggle para mostrar/ocultar filtros
    $('#btn-toggle-filtros').on('click', function(){
        var $btn = $(this);
        var $container = $('#filtros-container');

        $btn.toggleClass('collapsed');
        $container.toggleClass('collapsed');

        var $span = $btn.find('span').first();
        if ($btn.hasClass('collapsed')) {
            $span.text('Mostrar Filtros');
        } else {
            $span.text('Ocultar Filtros');
        }
    });

    // Evento para el botón Filtrar
    $('#btn-aplicar-filtros').on('click', function(){
        cargarTabla();
        actualizarBadgeFiltros();
    });

    // Evento para el botón Limpiar
    $('#btn-limpiar-filtros').on('click', function(){
        limpiarFiltros();
    });

    // Permitir filtrar con Enter en campos de texto
    $('#filtro-username, #filtro-nombre, #filtro-email').on('keypress', function(e){
        if (e.which === 13) {
            cargarTabla();
            actualizarBadgeFiltros();
        }
    });

    // Botón volver arriba
    var $btnVolverArriba = $('#btn-volver-arriba');
    $(window).on('scroll', function() {
        if ($(this).scrollTop() > 300) {
            $btnVolverArriba.addClass('visible');
        } else {
            $btnVolverArriba.removeClass('visible');
        }
    });

    $btnVolverArriba.on('click', function() {
        $('html, body').animate({ scrollTop: 0 }, 400);
    });
});

// Función para contar y mostrar filtros activos
function actualizarBadgeFiltros() {
    var count = 0;

    if ($('#filtro-username').val().trim()) count++;
    if ($('#filtro-nombre').val().trim()) count++;
    if ($('#filtro-email').val().trim()) count++;
    if ($('#filtro-grupo').val()) count++;
    if ($('#filtro-sector').val()) count++;
    if ($('#filtro-origen').val()) count++;
    if ($('#filtro-estado').val()) count++;

    var $badge = $('#filtros-badge');
    if (count > 0) {
        $badge.text(count).removeClass('hidden');
    } else {
        $badge.addClass('hidden');
    }
}

// Función para limpiar todos los filtros
function limpiarFiltros() {
    $('#filtro-username').val('');
    $('#filtro-nombre').val('');
    $('#filtro-email').val('');
    $('#filtro-grupo').val('');
    $('#filtro-sector').val('');
    $('#filtro-origen').val('');
    $('#filtro-estado').val('');

    actualizarBadgeFiltros();
    cargarTabla();
}

var table;

function cargarTabla(){
    $('#data_table_ajax').dataTable().fnClearTable();
    $('#data_table_ajax').dataTable().fnDestroy();

    var valores = {
        "csrfmiddlewaretoken": '{{ csrf_token }}',
        "filtro_username": $("#filtro-username").val() || '',
        "filtro_nombre": $("#filtro-nombre").val() || '',
        "filtro_email": $("#filtro-email").val() || '',
        "filtro_grupo": $("#filtro-grupo").val() || '',
        "filtro_sector": $("#filtro-sector").val() || '',
        "filtro_origen": $("#filtro-origen").val() || '',
        "filtro_estado": $("#filtro-estado").val() || ''
    };

    table = $('#data_table_ajax').DataTable({
        autoWidth: false,
        processing: true,
        searching: true,
        ordering: true,
        dom: 'Bfrtip',
        language: {
            url: "https://cdn.datatables.net/plug-ins/1.11.3/i18n/es_es.json"
        },
        buttons: [
            {
                text: '<i class="fa fa-plus"></i> Nuevo Usuario',
                className: 'dt-btn-orange',
                action: function(e, dt, node, config) {
                    gestionUsuario('');
                }
            }
        ],
        "ajax": {
            "url": "{% url 'gestion_usuarios_ajax' %}",
            "data": valores,
            "async": false,
            "type": "POST",
            "dataSrc": "",
            "error": function(xhr, error, code) {
                Swal.fire({
                    title: 'Error!',
                    text: "No se pudo cargar la información. Intente nuevamente.",
                    icon: 'error'
                });
            }
        },
        "columns": [
            {
                "data": "username",
                "render": function(data, type, row) {
                    return '<span class="usuario-username">' + data + '</span>';
                }
            },
            {
                "data": null,
                "render": function(data, type, row) {
                    var initials = '';
                    if (data.first_name) initials += data.first_name.charAt(0).toUpperCase();
                    if (data.last_name) initials += data.last_name.charAt(0).toUpperCase();
                    if (!initials) initials = data.username.charAt(0).toUpperCase();

                    var nombre = data.nombre_completo || '-';
                    return '<div class="usuario-info-cell">' +
                           '<span class="usuario-avatar">' + initials + '</span>' +
                           '<span>' + nombre + '</span>' +
                           '</div>';
                }
            },
            {
                "data": "email",
                "render": function(data, type, row) {
                    return data || '<span class="text-muted">-</span>';
                }
            },
            {
                "data": "grupos",
                "render": function(data, type, row) {
                    if (data && data.length > 0) {
                        var badges = '';
                        data.forEach(function(grupo) {
                            badges += '<span class="badge-estado badge-grupo" style="margin: 2px;">' + grupo + '</span>';
                        });
                        return badges;
                    }
                    return '<span class="text-muted">Sin grupo</span>';
                }
            },
            {
                "data": "sector",
                "render": function(data, type, row) {
                    return data || '<span class="text-muted">-</span>';
                }
            },
            {
                "data": "origen_display",
                "render": function(data, type, row) {
                    if (data) {
                        return '<span class="badge-estado badge-origen">' + data + '</span>';
                    }
                    return '<span class="text-muted">-</span>';
                }
            },
            {
                "data": "is_active",
                "render": function(data, type, row) {
                    return getBadgeEstado(data);
                }
            },
            {
                "data": "last_login",
                "render": function(data, type, row) {
                    if (data) {
                        return '<small>' + data + '</small>';
                    }
                    return '<span class="text-muted">Nunca</span>';
                }
            },
            {
                "data": null,
                "sortable": false,
                "width": "20%",
                "className": "text-center",
                "render": function(data, type, row) {
                    var html = '<div class="acciones-container">';

                    // Botón Ver
                    html += '<button type="button" class="btn btn-accion btn-ver-usuario" title="Ver" value="' + data.id + '"><i class="fa fa-eye"></i></button>';

                    // Botón Editar
                    html += '<button type="button" class="btn btn-accion btn-editar-usuario" title="Editar" value="' + data.id + '"><i class="fa fa-edit"></i></button>';

                    // Botón Imprimir
                    html += '<button type="button" class="btn btn-accion btn-imprimir-usuario" title="Imprimir" value="' + data.id + '"><i class="fa fa-print"></i></button>';

                    // Botón Restablecer Contraseña
                    html += '<button type="button" class="btn btn-accion btn-reset-password" title="Restablecer Contraseña" value="' + data.id + '"><i class="fa fa-key"></i></button>';

                    // Botón Activar/Desactivar
                    if (data.is_active) {
                        html += '<button type="button" class="btn btn-accion btn-eliminar-usuario" title="Desactivar" value="' + data.id + '"><i class="fa fa-ban"></i></button>';
                    } else {
                        html += '<button type="button" class="btn btn-accion btn-activar-usuario" title="Activar" value="' + data.id + '"><i class="fa fa-check-circle"></i></button>';
                    }

                    html += '</div>';
                    return html;
                }
            }
        ],
        order: [[0, 'asc']],
        "rowCallback": function(row, data, index){
            if(!data.is_active){
                $(row).addClass('usuario-inactivo');
            }
        }
    });

    // También cargar cards para móvil
    cargarCards();
}

// Función para obtener badge de estado
function getBadgeEstado(isActive) {
    if (isActive) {
        return '<span class="badge-estado badge-activo">Activo</span>';
    } else {
        return '<span class="badge-estado badge-inactivo">Inactivo</span>';
    }
}

// ============================================
// Vista Móvil - Cards
// ============================================
var usuariosData = [];
var currentPage = 1;
var itemsPerPage = 5;

function cargarCards() {
    var $container = $('#usuarios-cards-container');

    // Mostrar loading
    $container.html('<div class="usuarios-cards-loading"><i class="fa fa-spinner fa-spin"></i><p>Cargando usuarios...</p></div>');

    var valores = {
        "csrfmiddlewaretoken": '{{ csrf_token }}',
        "filtro_username": $("#filtro-username").val() || '',
        "filtro_nombre": $("#filtro-nombre").val() || '',
        "filtro_email": $("#filtro-email").val() || '',
        "filtro_grupo": $("#filtro-grupo").val() || '',
        "filtro_sector": $("#filtro-sector").val() || '',
        "filtro_origen": $("#filtro-origen").val() || '',
        "filtro_estado": $("#filtro-estado").val() || ''
    };

    $.ajax({
        url: "{% url 'gestion_usuarios_ajax' %}",
        type: "POST",
        data: valores,
        success: function(data) {
            usuariosData = data;
            currentPage = 1;
            renderizarCards();
        },
        error: function(xhr, error, code) {
            $container.html('<div class="usuarios-cards-empty"><i class="fa fa-exclamation-circle"></i><p>Error al cargar usuarios</p></div>');
        }
    });
}

function renderizarCards() {
    var $container = $('#usuarios-cards-container');
    var totalItems = usuariosData.length;

    $('#usuarios-count').text(totalItems + ' usuario(s)');

    if (totalItems === 0) {
        $container.html('<div class="usuarios-cards-empty"><i class="fa fa-users"></i><p>No se encontraron usuarios</p></div>');
        $('#mobile-pagination').hide();
        return;
    }

    var totalPages = Math.ceil(totalItems / itemsPerPage);
    var startIndex = (currentPage - 1) * itemsPerPage;
    var endIndex = Math.min(startIndex + itemsPerPage, totalItems);
    var usuariosPagina = usuariosData.slice(startIndex, endIndex);

    var html = '';
    usuariosPagina.forEach(function(usuario) {
        var cardClass = usuario.is_active ? '' : 'card-inactivo';
        var initials = '';
        if (usuario.first_name) initials += usuario.first_name.charAt(0).toUpperCase();
        if (usuario.last_name) initials += usuario.last_name.charAt(0).toUpperCase();
        if (!initials) initials = usuario.username.charAt(0).toUpperCase();

        html += '<div class="usuario-card ' + cardClass + '">';
        html += '    <div class="usuario-card-header">';
        html += '        <span class="usuario-card-username">' + usuario.username + '</span>';
        html += '        <span class="usuario-card-estado">' + getBadgeEstado(usuario.is_active) + '</span>';
        html += '    </div>';
        html += '    <div class="usuario-card-body">';
        html += '        <div class="usuario-card-nombre">' + (usuario.nombre_completo || '-') + '</div>';
        html += '        <div class="usuario-card-email">' + (usuario.email || 'Sin email') + '</div>';
        html += '        <div class="usuario-card-info">';
        html += '            <div class="usuario-card-info-item">';
        html += '                <span class="label">Grupo</span>';
        html += '                <span class="value">' + (usuario.grupos && usuario.grupos.length > 0 ? usuario.grupos.join(', ') : '-') + '</span>';
        html += '            </div>';
        html += '            <div class="usuario-card-info-item">';
        html += '                <span class="label">Sector</span>';
        html += '                <span class="value">' + (usuario.sector || '-') + '</span>';
        html += '            </div>';
        html += '            <div class="usuario-card-info-item">';
        html += '                <span class="label">Rol</span>';
        html += '                <span class="value">' + (usuario.origen_display || '-') + '</span>';
        html += '            </div>';
        html += '            <div class="usuario-card-info-item">';
        html += '                <span class="label">Última conexión</span>';
        html += '                <span class="value">' + (usuario.last_login || 'Nunca') + '</span>';
        html += '            </div>';
        html += '        </div>';
        html += '    </div>';
        html += '    <div class="usuario-card-footer">';
        html += '        <button type="button" class="btn btn-ver" onclick="verUsuario(' + usuario.id + ')">';
        html += '            <i class="fa fa-eye"></i> Ver';
        html += '        </button>';
        html += '        <div class="dropdown dropdown-acciones">';
        html += '            <button type="button" class="btn btn-acciones dropdown-toggle" data-toggle="dropdown">';
        html += '                <i class="fa fa-ellipsis-v"></i>';
        html += '            </button>';
        html += '            <div class="dropdown-menu dropdown-menu-right">';
        html += '                <a class="dropdown-item" href="javascript:void(0)" onclick="gestionUsuario(' + usuario.id + ')"><i class="fa fa-edit text-warning"></i> Editar</a>';
        html += '                <a class="dropdown-item" href="javascript:void(0)" onclick="imprimirUsuario(' + usuario.id + ')"><i class="fa fa-print text-secondary"></i> Imprimir</a>';
        html += '                <a class="dropdown-item" href="javascript:void(0)" onclick="resetPassword(' + usuario.id + ')"><i class="fa fa-key text-primary"></i> Restablecer Contraseña</a>';
        html += '                <div class="dropdown-divider"></div>';
        if (usuario.is_active) {
            html += '                <a class="dropdown-item" href="javascript:void(0)" onclick="toggleUsuario(' + usuario.id + ', false)"><i class="fa fa-ban text-danger"></i> Desactivar</a>';
        } else {
            html += '                <a class="dropdown-item" href="javascript:void(0)" onclick="toggleUsuario(' + usuario.id + ', true)"><i class="fa fa-check-circle text-success"></i> Activar</a>';
        }
        html += '            </div>';
        html += '        </div>';
        html += '    </div>';
        html += '</div>';
    });

    $container.html(html);

    // Actualizar paginación
    if (totalPages > 1) {
        $('#mobile-pagination').show();
        $('#page-info').text(currentPage + ' de ' + totalPages);
        $('#btn-prev-page').prop('disabled', currentPage === 1);
        $('#btn-next-page').prop('disabled', currentPage === totalPages);
    } else {
        $('#mobile-pagination').hide();
    }
}

// Event handlers para paginación
$('#btn-prev-page').on('click', function() {
    if (currentPage > 1) {
        currentPage--;
        renderizarCards();
    }
});

$('#btn-next-page').on('click', function() {
    var totalPages = Math.ceil(usuariosData.length / itemsPerPage);
    if (currentPage < totalPages) {
        currentPage++;
        renderizarCards();
    }
});

// ============================================
// Funciones de acciones
// ============================================

function gestionUsuario(id) {
    var url = "{% url 'gestion_usuarios_form' %}";

    $('#modal-lg .modal-content').html('<div class="text-center p-5"><i class="fa fa-spinner fa-spin fa-3x" style="color: var(--theme-primary);"></i><p class="mt-3">Cargando...</p></div>');
    $('#modal-lg').modal('show');

    $.ajax({
        url: url,
        type: 'POST',
        data: {
            'pk': id || '',
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            $('#modal-lg .modal-content').html(response.html_form);
        },
        error: function() {
            $('#modal-lg .modal-content').html('<div class="modal-body"><div class="alert alert-danger">Error al cargar el formulario</div></div>');
        }
    });
}

function verUsuario(id) {
    var url = "{% url 'gestion_usuarios_ver' %}";

    $('#modal-lg .modal-content').html('<div class="text-center p-5"><i class="fa fa-spinner fa-spin fa-3x" style="color: var(--theme-primary);"></i><p class="mt-3">Cargando...</p></div>');
    $('#modal-lg').modal('show');

    $.ajax({
        url: url,
        type: 'POST',
        data: {
            'pk': id,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function(response) {
            $('#modal-lg .modal-content').html(response.html_form);
        },
        error: function() {
            $('#modal-lg .modal-content').html('<div class="modal-body"><div class="alert alert-danger">Error al cargar los datos</div></div>');
        }
    });
}

function imprimirUsuario(id) {
    window.open("{% url 'gestion_usuarios_imprimir' pk=0 %}".replace('0', id), '_blank');
}

function resetPassword(id) {
    Swal.fire({
        title: '¿Restablecer contraseña?',
        text: 'Se generará una nueva contraseña y se enviará al email del usuario.',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Sí, restablecer',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: 'Procesando...',
                html: '<i class="fa fa-spinner fa-spin fa-2x"></i>',
                showConfirmButton: false,
                allowOutsideClick: false
            });

            $.ajax({
                url: "{% url 'gestion_usuarios_reset_password' %}",
                type: 'POST',
                data: {
                    'pk': id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            title: 'Contraseña restablecida',
                            text: response.message,
                            icon: 'success'
                        });
                    } else {
                        Swal.fire({
                            title: 'Error',
                            text: response.message,
                            icon: 'error'
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        title: 'Error',
                        text: 'No se pudo restablecer la contraseña',
                        icon: 'error'
                    });
                }
            });
        }
    });
}

function toggleUsuario(id, activar) {
    var accion = activar ? 'activar' : 'desactivar';
    var titulo = activar ? '¿Activar usuario?' : '¿Desactivar usuario?';
    var texto = activar ? 'El usuario podrá acceder al sistema nuevamente.' : 'El usuario no podrá acceder al sistema.';

    Swal.fire({
        title: titulo,
        text: texto,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: activar ? '#28a745' : '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Sí, ' + accion,
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: "{% url 'gestion_usuarios_toggle' %}",
                type: 'POST',
                data: {
                    'pk': id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.success) {
                        Swal.fire({
                            title: activar ? 'Usuario activado' : 'Usuario desactivado',
                            icon: 'success',
                            timer: 1500,
                            showConfirmButton: false
                        });
                        cargarTabla();
                    } else {
                        Swal.fire({
                            title: 'Error',
                            text: response.message,
                            icon: 'error'
                        });
                    }
                },
                error: function() {
                    Swal.fire({
                        title: 'Error',
                        text: 'No se pudo completar la acción',
                        icon: 'error'
                    });
                }
            });
        }
    });
}

// Event handlers para botones de tabla
$(document).on('click', '.btn-ver-usuario', function() {
    verUsuario($(this).val());
});

$(document).on('click', '.btn-editar-usuario', function() {
    gestionUsuario($(this).val());
});

$(document).on('click', '.btn-imprimir-usuario', function() {
    imprimirUsuario($(this).val());
});

$(document).on('click', '.btn-reset-password', function() {
    resetPassword($(this).val());
});

$(document).on('click', '.btn-eliminar-usuario', function() {
    toggleUsuario($(this).val(), false);
});

$(document).on('click', '.btn-activar-usuario', function() {
    toggleUsuario($(this).val(), true);
});
</script>
{% endblock %}
