{% load static %}
<!doctype html>
<html lang="es" data-theme="light">

<head>
<title>{% block title %}Panel de Administración - RTV Pioli{% endblock %}</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

<link rel="icon" href="{% static 'panel/assets/images/favicon.ico' %}" type="image/x-icon">

<!-- VENDOR CSS -->
<link rel="stylesheet" href="{% static 'panel/assets/css/dataTables.min.css' %}">
<link rel="stylesheet" href="{% static 'panel/assets/vendor/nouislider/nouislider.min.css' %}" />

<link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.14.0-beta2/css/bootstrap-select.min.css">

<!-- MAIN CSS -->
<link rel="stylesheet" href="{% static 'panel/assets/css/main.css' %}">

<!-- THEME CONFIG CSS - Configuración centralizada de tema -->
<link rel="stylesheet" href="{% static 'panel/assets/css/theme-config.css' %}">

<!-- SweetAlert2 - Librería moderna de alertas -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.5/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.5/dist/sweetalert2.all.min.js"></script>

<link rel="stylesheet" href="{% static 'panel/assets/vendor/parsleyjs/css/parsley.css' %}">

<!-- EXTRA CSS -->
{% block extraCss %}
{% endblock %}

</head>
<body data-theme="theme-navy">

<!-- Page Loader -->
<div class="page-loader-wrapper page-load text-center">
    <div class="loader">
        <div class="mt-4"><img src="{% static 'panel/assets/images/logo-blanco.png' %}" width="200px" alt=""></div>
    </div>
</div>

<div id="wrapper">

    <nav class="navbar navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-btn">
                <button type="button" class="btn-toggle-offcanvas text-light"><i class="lnr lnr-menu fa fa-bars"></i></button>
            </div>

            <div class="navbar-brand">
                <a href="{% url 'panel_home' %}">
                    <img class="img-fluid" src="{% static 'panel/assets/images/logo-blanco.png' %}" width="200px" alt="Logo">
                </a>
            </div>

            <div class="navbar-right">
                <div id="navbar-menu">
                    {% include "panel/navbar.html" %}
                </div>
            </div>
        </div>
    </nav>

    <div id="left-sidebar" class="sidebar">
        <div class="sidebar-scroll">
            <div class="user-account">
                <img src="{% static 'panel/assets/images/user.png' %}" class="rounded-circle user-photo" alt="User Profile Picture">
                <div class="dropdown">
                    <span>Bienvenido,</span>
                    <span class="user-name"><strong>{{ user.username }}</strong></span>
                </div>
            </div>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#menu">Menú</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#setting"><i class="icon-settings"></i></a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content ps-0 pe-0">
                <div class="tab-pane active" id="menu">
                    {% include 'panel/menu.html' %}
                </div>
                {% include 'panel/setting.html' %}
            </div>
        </div>
    </div>

    <!-- BLOQUE MAIN -->
    {% block main %}
    <div id="main-content">
        <div class="container-fluid">
            <div class="block-header">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <h2>{% block page_title %}Dashboard{% endblock %}</h2>
                    </div>
                </div>
            </div>
            {% block content %}
            {% endblock %}
        </div>
    </div>
    {% endblock %}

</div>

<div class="modal fade" id="modal-lg">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content"></div>
    </div>
</div>

<div class="modal fade" id="modal-fullscreen">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content"></div>
    </div>
</div>

<div class="modal fade" id="modal">
    <div class="modal-dialog">
        <div class="modal-content"></div>
    </div>
</div>

<div class="modal fade" id="modalLoad">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body text-center">
                <p class="mt-5 mb-5">
                    <i class="fa fa-spinner fa-spin fa-3x fa-fw mb-2"></i><br>
                    <span class="h6">Cargando información...</span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="aux"></div>

<!-- Javascript -->
<script src="{% static 'panel/assets/bundles/libscripts.bundle.js' %}"></script>
<!-- Fallback de jQuery desde CDN si no cargó del bundle -->
<script>window.jQuery || document.write('<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"><\/script>')</script>
<script src="{% static 'panel/assets/bundles/vendorscripts.bundle.js' %}"></script>
<script src="{% static 'panel/assets/bundles/datatablescripts.bundle.js' %}"></script>
<script src="{% static 'panel/assets/vendor/nouislider/nouislider.js' %}"></script>

<script src="{% static 'panel/assets/bundles/mainscripts.bundle.js' %}"></script>

<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>

<script src="{% static 'panel/assets/vendor/parsleyjs/js/parsley.min.js' %}"></script>
<!-- advanced-form-elements.js comentado - solo cargar en páginas que lo necesiten -->
<!-- <script src="{% static 'panel/assets/js/pages/forms/advanced-form-elements.js' %}"></script> -->

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

<script src="{% static 'panel/assets/js/js.js' %}"></script>
<script src="{% static 'panel/assets/js/theme-switcher.js' %}"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>

<!-- Script del slider de tamaño de fuente (setting.html) -->
<script>
$(function() {
    // Si hay tamaño guardado en sessionStorage, usarlo
    const fontSizeGuardado = sessionStorage.getItem("fontSize");
    if (fontSizeGuardado) {
        $("body, span, a, button, p, label, strong").css("font-size", fontSizeGuardado);
        const valorNumerico = parseInt(fontSizeGuardado);
        $("#miSlider").val(valorNumerico);
        $("#valorSlider").text(valorNumerico);
    }

    // Evento al mover el slider
    $('#miSlider').on('input', function() {
        const nuevaFuente = $(this).val();
        $("body, span, a, button, p, label, strong").css("font-size", nuevaFuente + "px");
        $('#valorSlider').text(nuevaFuente);
        sessionStorage.setItem("fontSize", nuevaFuente + "px");
    });
});
</script>

<!-- EXTRA JS -->
{% block extraJS %}
{% endblock %}

<script>
// Guardar y restaurar estado del menú lateral
$(document).ready(function() {
    var currentPath = window.location.pathname;

    // Buscar el enlace activo basado en la URL actual
    $('#main-menu a').each(function() {
        var href = $(this).attr('href');
        if (href && href !== 'javascript:;' && currentPath.indexOf(href) !== -1) {
            $(this).closest('li').addClass('active');
            $(this).closest('ul.collapse').addClass('in').closest('li').addClass('active');
        }
    });

    // Fix para conflicto entre metisMenu y Bootstrap collapse
    $('#main-menu').off('click.metisMenu');

    $('#main-menu').on('click', 'a.has-arrow', function(e) {
        e.preventDefault();
        e.stopPropagation();

        var $this = $(this);
        var $parent = $this.parent('li');
        var $submenu = $parent.children('ul.collapse');

        if ($submenu.length === 0) return;

        if ($submenu.hasClass('in')) {
            $submenu.removeClass('in');
            $parent.removeClass('active');
            $this.attr('aria-expanded', 'false');
        } else {
            $parent.siblings('li').children('ul.collapse.in').removeClass('in');
            $parent.siblings('li').removeClass('active');
            $parent.siblings('li').children('a').attr('aria-expanded', 'false');

            $submenu.addClass('in');
            $parent.addClass('active');
            $this.attr('aria-expanded', 'true');
        }
    });
});

function convertirFecha(fechaInput) {
    if (!fechaInput) return "";

    let fecha;

    if (fechaInput.includes('T') || fechaInput.includes('Z')) {
        fecha = new Date(fechaInput);
    } else if (fechaInput.includes('-')) {
        const partes = fechaInput.split("-");
        if (partes.length === 3) {
            fecha = new Date(partes[0], partes[1] - 1, partes[2]);
        } else {
            return fechaInput;
        }
    } else {
        return fechaInput;
    }

    if (isNaN(fecha.getTime())) return fechaInput;

    const dia = String(fecha.getDate()).padStart(2, '0');
    const mes = String(fecha.getMonth() + 1).padStart(2, '0');
    const anio = fecha.getFullYear();

    return `${dia}-${mes}-${anio}`;
}
</script>
</body>
</html>
