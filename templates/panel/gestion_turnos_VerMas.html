<style>
    .section-container {
        margin-bottom: 1.5rem;
    }

    .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--theme-primary);
    }

    .section-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: #2c3e50;
    }

    .card.border-light {
        border: 1px solid #e0e0e0 !important;
        border-radius: 0.5rem;
    }

    .card-body.bg-section {
        background-color: #fafafa;
    }

    .btn-orange {
        background-color: var(--theme-primary);
        border-color: var(--theme-primary);
        color: white;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-orange:hover {
        background-color: var(--theme-primary-dark);
        border-color: var(--theme-primary-dark);
        color: white;
    }

    .btn-outline-orange {
        border-color: var(--theme-primary);
        color: var(--theme-primary);
        background: transparent;
    }

    .btn-outline-orange:hover {
        background-color: var(--theme-primary);
        border-color: var(--theme-primary);
        color: white;
    }

    .info-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 1px solid #e9ecef;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 0.75rem;
        transition: all 0.2s ease;
    }

    .info-card:hover {
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-color: var(--theme-primary);
    }

    .info-label {
        font-size: 0.8rem;
        color: #6c757d;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
    }

    .info-label i {
        margin-right: 0.5rem;
        color: var(--theme-primary);
        font-size: 0.9rem;
    }

    .info-value {
        font-size: 1rem;
        color: #2c3e50;
        font-weight: 600;
    }

    .info-value.empty {
        color: #adb5bd;
        font-style: italic;
        font-weight: 400;
    }

    .shadow-sm {
        box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.075) !important;
    }

    .badge-estado {
        display: inline-block;
        padding: 6px 12px;
        font-size: 12px;
        font-weight: 600;
        border-radius: 4px;
    }

    .badge-pendiente {
        background-color: #fff3cd;
        color: #856404;
    }

    .badge-confirmado {
        background-color: #d4edda;
        color: #155724;
    }

    .badge-en-curso {
        background-color: #cce5ff;
        color: #004085;
    }

    .badge-completado {
        background-color: #28a745;
        color: white;
    }

    .badge-cancelado {
        background-color: #f8d7da;
        color: #721c24;
    }

    .badge-no-asistio {
        background-color: #6c757d;
        color: white;
    }

    .qr-container {
        text-align: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 0.5rem;
    }

    .qr-container img {
        max-width: 150px;
        border: 2px solid var(--theme-primary);
        border-radius: 8px;
        padding: 5px;
        background: white;
    }

    .historial-item {
        padding: 10px 15px;
        border-left: 3px solid var(--theme-primary);
        background: #f8f9fa;
        margin-bottom: 10px;
        border-radius: 0 4px 4px 0;
    }

    .historial-item .fecha {
        font-size: 0.8rem;
        color: #6c757d;
    }

    .historial-item .accion {
        font-weight: 600;
        color: #2c3e50;
    }

    .historial-item .descripcion {
        font-size: 0.9rem;
        color: #495057;
    }

    .notificacion-badge {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }

    .notificacion-enviado {
        background-color: #d4edda;
        color: #155724;
    }

    .notificacion-pendiente {
        background-color: #fff3cd;
        color: #856404;
    }
</style>

<div class="modal-header" style="background: linear-gradient(135deg, var(--theme-primary) 0%, var(--theme-primary-dark) 100%);">
    <h5 class="modal-title text-white">
        <i class="fa fa-calendar-check-o me-2"></i>Detalle del Turno: {{ turno.codigo }}
    </h5>
    <button type="button" class="close text-white" onclick="$('#modal-lg').modal('hide');" aria-label="Cerrar">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<div class="modal-body">
    <!-- Estado del Turno -->
    <div class="section-container mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="badge-estado
                {% if turno.estado == 'PENDIENTE' %}badge-pendiente
                {% elif turno.estado == 'CONFIRMADO' %}badge-confirmado
                {% elif turno.estado == 'EN_CURSO' %}badge-en-curso
                {% elif turno.estado == 'COMPLETADO' %}badge-completado
                {% elif turno.estado == 'CANCELADO' %}badge-cancelado
                {% elif turno.estado == 'NO_ASISTIO' %}badge-no-asistio
                {% endif %}">
                {{ turno.get_estado_display }}
            </span>
            <span class="text-muted small">
                <i class="fa fa-clock-o me-1"></i>Creado: {{ turno.created_at|date:"d/m/Y H:i" }}
            </span>
        </div>
    </div>

    <!-- Fila 1: Datos del Cliente + Código QR (misma altura) -->
    <div class="row align-items-stretch mb-4">
        <!-- Datos del Cliente -->
        <div class="col-lg-8">
            <div class="section-container h-100 mb-0">
                <div class="section-header">
                    <i class="fa fa-user text-primary me-2"></i>
                    <h6 class="section-title">Datos del Cliente</h6>
                </div>

                <div class="card border-light shadow-sm h-100">
                    <div class="card-body bg-section p-3">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-user"></i> Nombre Completo
                                    </div>
                                    <div class="info-value">{{ turno.cliente.nombre }} {{ turno.cliente.apellido }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-id-card"></i> DNI
                                    </div>
                                    <div class="info-value">{{ turno.cliente.dni }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-envelope"></i> Email
                                    </div>
                                    <div class="info-value {% if not turno.cliente.email %}empty{% endif %}">
                                        {{ turno.cliente.email|default:"No registrado" }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-phone"></i> Teléfono
                                    </div>
                                    <div class="info-value {% if not turno.cliente.celular %}empty{% endif %}">
                                        {{ turno.cliente.celular|default:"No registrado" }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Código QR -->
        <div class="col-lg-4">
            {% if turno.qr_code %}
            <div class="section-container h-100 mb-0">
                <div class="section-header">
                    <i class="fa fa-qrcode text-primary me-2"></i>
                    <h6 class="section-title">Código QR</h6>
                </div>

                <div class="qr-container h-100 d-flex flex-column justify-content-center align-items-center">
                    <img src="{{ turno.qr_code.url }}" alt="QR del Turno" class="img-fluid mx-auto d-block">
                    <p class="text-muted small mt-2 mb-0 text-center">Escanear para verificar turno</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <!-- Columna Izquierda -->
        <div class="col-lg-8">

            <!-- Datos del Vehículo -->
            <div class="section-container mb-4">
                <div class="section-header">
                    <i class="fa fa-car text-primary me-2"></i>
                    <h6 class="section-title">Datos del Vehículo</h6>
                </div>

                <div class="card border-light shadow-sm">
                    <div class="card-body bg-section p-3">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-hashtag"></i> Dominio
                                    </div>
                                    <div class="info-value">{{ turno.vehiculo.dominio }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-industry"></i> Marca
                                    </div>
                                    <div class="info-value">{{ turno.vehiculo.marca|default:"-" }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-car"></i> Modelo
                                    </div>
                                    <div class="info-value">{{ turno.vehiculo.modelo|default:"-" }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-tag"></i> Tipo de Trámite
                                    </div>
                                    <div class="info-value">{{ turno.tipo_vehiculo.nombre_normalizado }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-calendar"></i> Año
                                    </div>
                                    <div class="info-value {% if not turno.vehiculo.anio %}empty{% endif %}">
                                        {{ turno.vehiculo.anio|default:"No registrado" }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Datos del Turno -->
            <div class="section-container mb-4">
                <div class="section-header">
                    <i class="fa fa-calendar text-primary me-2"></i>
                    <h6 class="section-title">Información del Turno</h6>
                </div>

                <div class="card border-light shadow-sm">
                    <div class="card-body bg-section p-3">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-building"></i> Taller
                                    </div>
                                    <div class="info-value">{{ turno.taller.get_nombre }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-map-marker"></i> Dirección del Taller
                                    </div>
                                    <div class="info-value {% if not turno.taller.get_direccion %}empty{% endif %}">
                                        {{ turno.taller.get_direccion|default:"No especificada" }}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-calendar"></i> Fecha
                                    </div>
                                    <div class="info-value">{{ turno.fecha|date:"d/m/Y" }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-clock-o"></i> Horario
                                    </div>
                                    <div class="info-value">{{ turno.hora_inicio|time:"H:i" }} - {{ turno.hora_fin|time:"H:i" }}</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-hourglass-half"></i> Días para el turno
                                    </div>
                                    <div class="info-value">
                                        {% if turno.dias_para_turno > 0 %}
                                            {{ turno.dias_para_turno }} día(s)
                                        {% elif turno.dias_para_turno == 0 %}
                                            <span class="text-warning">Hoy</span>
                                        {% else %}
                                            <span class="text-muted">Ya pasó</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% if turno.observaciones %}
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="info-card">
                                    <div class="info-label">
                                        <i class="fa fa-comment"></i> Observaciones
                                    </div>
                                    <div class="info-value">{{ turno.observaciones }}</div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Historial del Turno -->
            {% if turno.historial.exists %}
            <div class="section-container mb-4">
                <div class="section-header">
                    <i class="fa fa-history text-primary me-2"></i>
                    <h6 class="section-title">Historial de Acciones</h6>
                </div>

                <div class="card border-light shadow-sm">
                    <div class="card-body bg-section p-3">
                        {% for h in turno.historial.all %}
                        <div class="historial-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <span class="accion">{{ h.accion }}</span>
                                    <p class="descripcion mb-0">{{ h.descripcion }}</p>
                                </div>
                                <span class="fecha">{{ h.fecha|date:"d/m/Y H:i" }}</span>
                            </div>
                            {% if h.usuario %}
                            <small class="text-muted"><i class="fa fa-user me-1"></i>{{ h.usuario.username }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Columna Derecha -->
        <div class="col-lg-4">
            <!-- Estado de Notificaciones -->
            <div class="section-container mb-4">
                <div class="section-header">
                    <i class="fa fa-bell text-primary me-2"></i>
                    <h6 class="section-title">Notificaciones</h6>
                </div>

                <div class="card border-light shadow-sm">
                    <div class="card-body bg-section p-3">
                        <div class="d-flex flex-column gap-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <span><i class="fa fa-envelope me-2"></i>Email</span>
                                <span class="notificacion-badge {% if turno.email_enviado %}notificacion-enviado{% else %}notificacion-pendiente{% endif %}">
                                    {% if turno.email_enviado %}
                                    <i class="fa fa-check"></i> Enviado
                                    {% else %}
                                    <i class="fa fa-clock-o"></i> Pendiente
                                    {% endif %}
                                </span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span><i class="fa fa-whatsapp me-2"></i>WhatsApp</span>
                                <span class="notificacion-badge {% if turno.whatsapp_enviado %}notificacion-enviado{% else %}notificacion-pendiente{% endif %}">
                                    {% if turno.whatsapp_enviado %}
                                    <i class="fa fa-check"></i> Enviado
                                    {% else %}
                                    <i class="fa fa-clock-o"></i> Pendiente
                                    {% endif %}
                                </span>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span><i class="fa fa-bell me-2"></i>Recordatorio</span>
                                <span class="notificacion-badge {% if turno.recordatorio_enviado %}notificacion-enviado{% else %}notificacion-pendiente{% endif %}">
                                    {% if turno.recordatorio_enviado %}
                                    <i class="fa fa-check"></i> Enviado
                                    {% else %}
                                    <i class="fa fa-clock-o"></i> Pendiente
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Información de Auditoría -->
            <div class="section-container mb-4">
                <div class="section-header">
                    <i class="fa fa-info-circle text-primary me-2"></i>
                    <h6 class="section-title">Información Adicional</h6>
                </div>

                <div class="card border-light shadow-sm">
                    <div class="card-body bg-section p-3">
                        <small class="text-muted d-block mb-2">
                            <i class="fa fa-plus-circle me-1"></i>
                            <strong>Creado:</strong> {{ turno.created_at|date:"d/m/Y H:i" }}
                        </small>
                        <small class="text-muted d-block mb-2">
                            <i class="fa fa-edit me-1"></i>
                            <strong>Actualizado:</strong> {{ turno.updated_at|date:"d/m/Y H:i" }}
                        </small>
                        {% if turno.created_by %}
                        <small class="text-muted d-block">
                            <i class="fa fa-user me-1"></i>
                            <strong>Creado por:</strong> {{ turno.created_by.username }}
                        </small>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-outline-orange" onclick="gestionTurno({{ turno.id }}); $('#modal-lg').modal('hide');">
        <i class="fa fa-edit me-1"></i>Editar Turno
    </button>
    <button type="button" class="btn btn-outline-dark" onclick="$('#modal-lg').modal('hide');">
        <i class="fa fa-times me-1"></i>Cerrar
    </button>
</div>
